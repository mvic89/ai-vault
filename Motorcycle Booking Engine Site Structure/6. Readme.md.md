(OSM extractor docs)

# OSM Motorcycle Repair Shop Extractor

A Python tool to automatically download OpenStreetMap data from Geofabrik for multiple EU countries and extract motorcycle repair shops into a CSV file.

## Features

- ✅ Downloads `.osm.pbf` files from Geofabrik for any EU country
- ✅ Extracts motorcycle repair shops using comprehensive OSM tagging
- ✅ Exports to CSV with full location and contact details
- ✅ Processes multiple countries in one run
- ✅ Resume capability (skips already downloaded files)
- ✅ Progress tracking for downloads and processing

## What is OSM and PBF?

**OpenStreetMap (OSM)** is a collaborative mapping project with detailed, crowdsourced geographic data worldwide.

**PBF (Protobuf Binary Format)** is a highly compressed binary format for OSM data. A `.osm.pbf` file can be 10-30x smaller than XML format while containing the same information.

**Geofabrik** provides free, regularly updated extracts of OSM data by country/region, making it the standard source for OSM data downloads.

## Installation

### Prerequisites

- Python 3.8 or higher
- pip package manager

### Install Dependencies

```bash
pip install osmium requests
```

Or using the requirements file:

```bash
pip install -r requirements.txt
```

## Quick Start

### 1. List Available Countries

```bash
python osm_mc_repair_extractor.py --list-countries
```

This shows all 27 EU countries available for download.

### 2. Extract Shops from Single Country

```bash
python osm_mc_repair_extractor.py germany
```

This will:

1. Download `germany-latest.osm.pbf` (~3.8 GB)
2. Extract all motorcycle repair shops
3. Save to `motorcycle_repair_shops.csv`

### 3. Process Multiple Countries

```bash
python osm_mc_repair_extractor.py germany france spain italy
```

Processes multiple countries and combines results into one CSV.

### 4. Custom Output File

```bash
python osm_mc_repair_extractor.py netherlands --output nl_motorcycle_shops.csv
```

### 5. Process Already Downloaded Files

If you already have PBF files downloaded:

```bash
python osm_mc_repair_extractor.py germany --skip-download
```

## Command Line Options

```
usage: osm_mc_repair_extractor.py [-h] [--output OUTPUT] 
                                   [--download-dir DOWNLOAD_DIR]
                                   [--skip-download] [--force-redownload]
                                   [--list-countries]
                                   [countries ...]

positional arguments:
  countries             Country names to process (e.g., germany france spain)

optional arguments:
  -h, --help            Show this help message and exit
  --output OUTPUT, -o OUTPUT
                        Output CSV filename (default: motorcycle_repair_shops.csv)
  --download-dir DOWNLOAD_DIR
                        Directory for downloaded PBF files (default: osm_downloads)
  --skip-download       Skip downloading, only process existing files
  --force-redownload    Force re-download even if files exist
  --list-countries      List all available countries and exit
```

## OSM Tags Detected

The script identifies motorcycle repair shops using these OpenStreetMap tags:

|Tag|Description|Example|
|---|---|---|
|`shop=motorcycle_repair`|Primary tag for MC repair shops|Most common|
|`shop=motorcycle`|Motorcycle shops (often do repairs)|Dealerships|
|`amenity=motorcycle_repair`|Alternative amenity tag|Less common|
|`craft=motorcycle_repair`|Craft-based repair shops|Independent mechanics|
|`service:vehicle:motorcycle=yes`|With repair capability|Multi-service garages|

## CSV Output Format

The exported CSV contains these columns:

### Identification

- `osm_id` - Unique OSM element ID
- `osm_type` - Element type (node/way/area)
- `name` - Business name
- `brand` - Brand name (if franchise)
- `operator` - Operator name

### Location

- `latitude` - GPS latitude
- `longitude` - GPS longitude
- `address_street` - Street name
- `address_housenumber` - House number
- `address_city` - City name
- `address_postcode` - Postal code
- `address_country` - Country code

### Contact

- `phone` - Phone number
- `mobile` - Mobile number
- `email` - Email address
- `website` - Website URL
- `opening_hours` - Opening hours in OSM format

### Classification

- `shop_type` - Shop tag value
- `amenity` - Amenity tag value
- `craft` - Craft tag value
- `service_motorcycle` - Motorcycle service flag
- `service_repair` - Repair service flag

## Examples

### Example 1: Quick Start with Small Countries

Start with smaller countries for faster testing:

```bash
python osm_mc_repair_extractor.py luxembourg malta cyprus
```

**File sizes:**

- Luxembourg: ~25 MB
- Malta: ~15 MB
- Cyprus: ~35 MB

**Processing time:** ~1-2 minutes total

### Example 2: Process Nordic Countries

```bash
python osm_mc_repair_extractor.py sweden denmark finland norway --output nordic_mc_shops.csv
```

### Example 3: Western Europe Bundle

```bash
python osm_mc_repair_extractor.py germany france netherlands belgium luxembourg --output western_eu_mc_shops.csv
```

### Example 4: Re-process Without Re-downloading

If you want to adjust the extraction logic and re-run:

```bash
python osm_mc_repair_extractor.py germany france --skip-download
```

## File Size Reference

Approximate PBF file sizes for common countries:

|Country|File Size|Processing Time*|
|---|---|---|
|Luxembourg|25 MB|< 1 min|
|Malta|15 MB|< 1 min|
|Slovenia|80 MB|1-2 min|
|Estonia|90 MB|1-2 min|
|Netherlands|900 MB|5-10 min|
|Belgium|450 MB|3-5 min|
|Poland|1.1 GB|10-15 min|
|Spain|1.8 GB|15-20 min|
|France|3.6 GB|30-40 min|
|Germany|3.8 GB|30-40 min|
|Italy|2.4 GB|20-30 min|

*Processing time estimates on modern hardware (SSD, 8GB RAM)

## Project Structure

```
your-project/
├── osm_mc_repair_extractor.py   # Main script
├── requirements.txt              # Python dependencies
├── README.md                     # This file
├── osm_downloads/                # Downloaded PBF files (auto-created)
│   ├── germany-latest.osm.pbf
│   ├── france-latest.osm.pbf
│   └── ...
└── motorcycle_repair_shops.csv   # Output (generated)
```

## How It Works

### 1. **Download Phase**

- Connects to Geofabrik's download server
- Downloads `.osm.pbf` files for specified countries
- Shows progress with download percentage and MB transferred
- Skips files that already exist (unless `--force-redownload`)

### 2. **Processing Phase**

- Uses `pyosmium` library to parse PBF files efficiently
- Scans all OSM nodes, ways, and areas
- Applies filter logic to identify motorcycle repair shops
- Extracts all relevant tags (name, address, contact info)

### 3. **Export Phase**

- Combines results from all countries
- Removes duplicates (if any)
- Exports to CSV with UTF-8 encoding
- Reports final count and file location

## Tips & Best Practices

### 1. Start Small

Test with smaller countries first to ensure everything works:

```bash
python osm_mc_repair_extractor.py luxembourg
```

### 2. Disk Space

Ensure you have enough disk space:

- Small country (Luxembourg): ~25 MB
- Large country (Germany): ~4 GB
- Processing all EU: ~30-40 GB

### 3. Processing Time

Large countries take time to process. Consider:

- Running overnight for multiple large countries
- Processing countries in batches
- Using SSD storage for faster processing

### 4. Data Freshness

Geofabrik updates files daily. To get fresh data:

```bash
python osm_mc_repair_extractor.py germany --force-redownload
```

### 5. Resume Capability

If interrupted, just run the same command again. Downloaded files are kept and won't be re-downloaded.

## Troubleshooting

### Problem: "Country not found"

**Solution:** Check spelling. Use `--list-countries` to see exact names.

### Problem: Download fails

**Solution:**

- Check internet connection
- Geofabrik servers might be temporarily down
- Try again later

### Problem: Memory error during processing

**Solution:**

- Process fewer countries at once
- Close other applications
- Process large countries individually

### Problem: No shops found

**Solution:**

- This might be correct - not all countries have shops tagged in OSM
- Try a different country to verify the script works
- Check OSM website to confirm shops exist in that region

## Data Quality Notes

OSM data quality varies by region:

- **Well-mapped countries:** Germany, Netherlands, France, UK (Ireland)
- **Varies by region:** Spain, Italy, Poland
- **May be incomplete:** Some Eastern European countries

The number of results depends on:

1. How many motorcycle repair shops exist
2. How well OSM is maintained in that region
3. Whether shops are properly tagged

## Contributing to OSM

If you find missing motorcycle repair shops:

1. Visit [openstreetmap.org](https://www.openstreetmap.org)
2. Create a free account
3. Add missing shops with appropriate tags
4. Changes appear in Geofabrik extracts within ~24 hours

## Data License

OpenStreetMap data is licensed under the Open Database License (ODbL). When using this data:

- ✅ You can use it for commercial purposes
- ✅ You must attribute OpenStreetMap contributors
- ✅ Derivative works must use the same license

Example attribution:

> "Data © OpenStreetMap contributors, available under the Open Database License"

More info: https://www.openstreetmap.org/copyright

## Support & Resources

- **OpenStreetMap Wiki:** https://wiki.openstreetmap.org/
- **Geofabrik Downloads:** https://download.geofabrik.de/
- **OSM Tagging Guidelines:** https://wiki.openstreetmap.org/wiki/Tag:shop=motorcycle_repair
- **PyOsmium Documentation:** https://osmcode.org/pyosmium/

## Author

Created for the EU Motorcycle Repair Shop Directory Project  
Date: October 29, 2025

## License

This script is released under the MIT License. Feel free to modify and use for your project!